<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Grageas M√°gicas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;500;600&family=Luckiest+Guy&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        h1, h2.decorated-title, h3 {
            font-family: 'Cinzel', serif;
        }
        .font-luckiest {
            font-family: 'Luckiest Guy', cursive;
        }
        /* Estilo para la barra de desplazamiento */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        .tab-btn.active {
            border-color: #f59e0b; /* yellow-500 */
            color: #f59e0b;
            background-color: #374151; /* gray-700 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Columna de Configuraci√≥n y Referencia -->
        <div class="lg:col-span-1 flex flex-col gap-8">
            <!-- Secci√≥n de Configuraci√≥n -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
                <h1 class="text-3xl font-bold text-yellow-400 mb-6 text-center">Configuraci√≥n</h1>
                
                <div class="space-y-4">
                    <div>
                        <label for="cantidadGrageas" class="block mb-2 text-sm font-medium text-gray-300">N√∫mero de Grageas (M√°x. 5):</label>
                        <input type="number" id="cantidadGrageas" value="1" min="1" max="5" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-yellow-500 focus:border-yellow-500 block w-full p-2.5">
                    </div>
                    
                    <div id="grageasContainer" class="space-y-6">
                        <!-- Los selectores de grageas se insertar√°n aqu√≠ -->
                    </div>
                    
                    <button id="abrirBtn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-md">
                        ‚ú® Abrir Grageas
                    </button>
                </div>
            </div>

            <!-- Secci√≥n de Sabores Disponibles -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
                <h2 class="text-2xl font-bold text-yellow-400 mb-4 text-center decorated-title">Sabores Disponibles</h2>
                <div id="saboresList" class="max-h-80 overflow-y-auto pr-2 grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                    <!-- La lista de sabores se insertar√° aqu√≠ -->
                </div>
            </div>
        </div>

        <!-- Columna de Resultados -->
        <div class="lg:col-span-2">
            <div class="bg-black p-6 rounded-2xl shadow-lg border border-gray-700 h-full flex flex-col min-h-[80vh] lg:min-h-0">
                <!-- Pesta√±as para cambiar de vista -->
                <div class="flex border-b border-gray-700 mb-4">
                    <button id="tabDecorado" class="tab-btn active py-2 px-4 border-b-2 font-medium transition-colors duration-300">Decorado</button>
                    <button id="tabSimple" class="tab-btn py-2 px-4 border-b-2 border-transparent font-medium text-gray-400 hover:text-yellow-400 transition-colors duration-300">Simple</button>
                </div>

                <!-- Contenedor de Resultados Decorados (visible por defecto) -->
                <div id="panelDecorado" class="flex flex-col flex-grow">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-yellow-400 decorated-title">Resultados</h2>
                        <button id="copiarBtnDecorado" class="bg-gray-700 hover:bg-gray-600 text-gray-200 font-medium py-2 px-4 rounded-lg transition duration-300 ease-in-out flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
                            Copiar Decorado
                        </button>
                    </div>
                    <div class="relative flex-grow">
                        <textarea id="resultadoTextoDecorado" readonly class="w-full h-full bg-black text-white font-mono p-4 rounded-md border border-gray-600 resize-none focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
                    </div>
                </div>

                <!-- Contenedor de Resultados Simples (oculto por defecto) -->
                <div id="panelSimple" class="hidden flex-col flex-grow">
                     <div class="flex justify-end items-center mb-4">
                        <button id="copiarBtnSimple" class="bg-gray-700 hover:bg-gray-600 text-gray-200 font-medium py-2 px-4 rounded-lg transition duration-300 ease-in-out flex items-center gap-2">
                           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
                            Copiar Simple
                        </button>
                    </div>
                    <div id="resultadoTextoSimpleContainer" class="w-full h-full bg-black text-white p-4 rounded-md border border-gray-600 overflow-y-auto">
                        <h2 id="simpleTitle" class="text-4xl text-white font-luckiest tracking-wider mb-6"></h2>
                        <div id="resultadoTextoSimple" style="white-space: pre-wrap; font-family: 'Inter', sans-serif; font-size: 1.1rem; line-height: 2;"></div>
                    </div>
                </div>

                <!-- Mensaje de Copiado -->
                <div id="copiadoMsg" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-green-500 text-white px-6 py-3 rounded-lg text-lg opacity-0 transition-opacity duration-500 pointer-events-none">
                    ¬°Texto Copiado!
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DATOS ---
            const sabores = [
                { "tipo": "Aceitunas", "emoji": "ü´í" }, { "tipo": "Ajo crudo", "emoji": "üßÑ" }, { "tipo": "Alga marina", "emoji": "ü™∏" },
                { "tipo": "Aliento de drag√≥n", "emoji": "üêâüå¨Ô∏è" }, { "tipo": "Aliento de ogro", "emoji": "üßå" }, { "tipo": "Algod√≥n de az√∫car", "emoji": "üç≠" },
                { "tipo": "Ar√°ndanos", "emoji": "ü´ê" }, { "tipo": "Baba de caracol", "emoji": "üêå" }, { "tipo": "Bellini", "emoji": "ü•Ç" },
                { "tipo": "Biber√≥n", "emoji": "üçº" }, { "tipo": "Blody Mary", "emoji": "ü´óü©∏" }, { "tipo": "Burrito", "emoji": "üåØ" },
                { "tipo": "Cacahuate", "emoji": "ü•ú" }, { "tipo": "Ca√±a de az√∫car", "emoji": "üéã" }, { "tipo": "Canela en polvo", "emoji": "üçÇ" },
                { "tipo": "C√°scara de pl√°tano", "emoji": "üçå" }, { "tipo": "Caf√© fr√≠o", "emoji": "‚òï" }, { "tipo": "Caf√© quemado", "emoji": "‚òïüî•" },
                { "tipo": "Caldo de murci√©lago", "emoji": "ü¶áüç≤" }, { "tipo": "Cebolla caramelizada", "emoji": "üßÖ" }, { "tipo": "Cereza", "emoji": "üçí" },
                { "tipo": "Cerveza", "emoji": "üç∫" }, { "tipo": "Chicle de menta", "emoji": "üç¨" }, { "tipo": "Chorizo", "emoji": "ü•©" },
                { "tipo": "C√≠tricos", "emoji": "üçã" }, { "tipo": "Coco", "emoji": "ü••" }, { "tipo": "C√≥ctel", "emoji": "üç∏" },
                { "tipo": "Coliflor cruda", "emoji": "ü•¶" }, { "tipo": "Cera de o√≠do", "emoji": "üëÇ" }, { "tipo": "Champa√±a", "emoji": "ü•Ç" },
                { "tipo": "Chocolate", "emoji": "üç´" }, { "tipo": "Cupcake", "emoji": "üßÅ" }, { "tipo": "Donas", "emoji": "üç©" },
                { "tipo": "Dumpling", "emoji": "ü•ü" }, { "tipo": "Durazno", "emoji": "üçë" }, { "tipo": "Ensalada", "emoji": "ü•ó" },
                { "tipo": "Esencia de mandr√°gora", "emoji": "üå±" }, { "tipo": "Espinaca cocida", "emoji": "üç≤" }, { "tipo": "Espuma de mar", "emoji": "üåä" },
                { "tipo": "Esti√©rcol de drag√≥n", "emoji": "üêâüí©" }, { "tipo": "Flor de cactus", "emoji": "üåµ" }, { "tipo": "Frutilla", "emoji": "üçì" },
                { "tipo": "Galleta de avena", "emoji": "üç™" }, { "tipo": "Gelatina de sapo", "emoji": "üê∏" }, { "tipo": "Guisado", "emoji": "üçõ" },
                { "tipo": "Guisantes triturados", "emoji": "ü´õ" }, { "tipo": "Helado de calabaza", "emoji": "üéÉ" }, { "tipo": "Helado de vainilla", "emoji": "üç®" },
                { "tipo": "Hielo", "emoji": "üßä" }, { "tipo": "Hojas secas", "emoji": "üçÅ" }, { "tipo": "Hueso drag√≥n tostado", "emoji": "ü¶¥" },
                { "tipo": "Huevo frito", "emoji": "üç≥" }, { "tipo": "Huevo podrido", "emoji": "ü•ö" }, { "tipo": "Jarabe de arce", "emoji": "üçØ" },
                { "tipo": "Jugo de pepino", "emoji": "ü•í" }, { "tipo": "Kiwi", "emoji": "ü•ù" }, { "tipo": "Leche", "emoji": "üêÆ" },
                { "tipo": "Leche caducada", "emoji": "ü•õ" }, { "tipo": "Leche podrida", "emoji": "üßã" }, { "tipo": "Manteca de man√≠", "emoji": "ü•ú" },
                { "tipo": "Manteca rancia", "emoji": "üßà" }, { "tipo": "Margarita", "emoji": "üç∏" }, { "tipo": "Martini", "emoji": "üç∏" },
                { "tipo": "Mate", "emoji": "üßâ" }, { "tipo": "Menta", "emoji": "üåø" }, { "tipo": "Mezcla de hongos", "emoji": "üçÑ" },
                { "tipo": "Mermelada de escarabajo", "emoji": "ü™≤" }, { "tipo": "Moco", "emoji": "ü¶†" }, { "tipo": "Naruto", "emoji": "üç•" },
                { "tipo": "Negroni", "emoji": "ü•É" }, { "tipo": "Onigiri", "emoji": "üçô" }, { "tipo": "Ostras vivas", "emoji": "ü¶™" },
                { "tipo": "Pan con hongos", "emoji": "ü´ì" }, { "tipo": "Papas fritas", "emoji": "üçü" }, { "tipo": "Pasta de dientes", "emoji": "ü™•" },
                { "tipo": "Pasta pegajosa", "emoji": "üçù" }, { "tipo": "Pastel", "emoji": "üç∞" }, { "tipo": "Pepino", "emoji": "ü•í" },
                { "tipo": "Picante", "emoji": "üå∂Ô∏è" }, { "tipo": "Pie de manzana", "emoji": "ü•ß" }, { "tipo": "Pimiento asado", "emoji": "ü´ë" },
                { "tipo": "Pi√±a colada", "emoji": "üçπ" }, { "tipo": "Pizza", "emoji": "üçï" }, { "tipo": "Pollo asado", "emoji": "üçó" },
                { "tipo": "Polvos m√°gicos", "emoji": "‚ú®" }, { "tipo": "Pud√≠n", "emoji": "üçÆ" }, { "tipo": "Queso mohoso", "emoji": "üßÄ" },
                { "tipo": "Ra√≠z de mandr√°gora", "emoji": "üå±" }, { "tipo": "Ron a√±ejo", "emoji": "üçæ" }, { "tipo": "Sal marina", "emoji": "üßÇ" },
                { "tipo": "Sand√≠a", "emoji": "üçâ" }, { "tipo": "Sangre", "emoji": "ü©∏" }, { "tipo": "Sangre de unicornio", "emoji": "ü¶Ñ" },
                { "tipo": "Sangre de unicornio oxidada", "emoji": "ü¶Ñ" }, { "tipo": "Sardinas enlatadas", "emoji": "üêü" }, { "tipo": "Sexo en la playa", "emoji": "ü•ÉüèñÔ∏è" },
                { "tipo": "Soju", "emoji": "üç∂" }, { "tipo": "Sopa de pescado", "emoji": "üçµ" }, { "tipo": "Sopa de pescado en mal estado", "emoji": "üçµ" },
                { "tipo": "Spaguetti", "emoji": "üçù" }, { "tipo": "Sudor", "emoji": "üí¶" }, { "tipo": "Sudor de troll", "emoji": "üßü‚Äç‚ôÇÔ∏èüí¶" },
                { "tipo": "Sushi", "emoji": "üç£" }, { "tipo": "Tacos", "emoji": "üåÆ" }, { "tipo": "Tinta de pulpo", "emoji": "üêô" },
                { "tipo": "Trigo seco", "emoji": "üåæ" }, { "tipo": "Tronco podrido", "emoji": "ü™µ" }, { "tipo": "Tocino", "emoji": "ü•ì" },
                { "tipo": "Vino", "emoji": "üç∑" }, { "tipo": "V√≥mito", "emoji": "ü§Æ" }, { "tipo": "Waffles", "emoji": "üßá" }, { "tipo": "Whisky", "emoji": "ü•É" }, { "tipo": "Beso no correspondido", "emoji": "üíãüíî" },
              { "tipo": "Chisme express", "emoji": "ü´¶‚òïÔ∏è" },
              { "tipo": "Drama queen", "emoji": "üëëüíÖüèº" },
              { "tipo": "Ex", "emoji": "üëÖ" },
              { "tipo": "Exponme", "emoji": "üëÄüîÆ" },
              { "tipo": "Lo juro", "emoji": "‚úãüèª" },
              { "tipo": "Redflag", "emoji": "üö©" },
              { "tipo": "Tamal", "emoji": "ü´î" },
              { "tipo": "Te negro", "emoji": "ü´ñüñ§" }
            ];

            // --- INICIO: CONFIGURACI√ìN DE PROBABILIDADES (OCULTO) ---
            
            // 1. Separamos los efectos en categor√≠as
            const efectosBuenos = [
                "+10.000 puntos", "+8.000 puntos", "+5.000 puntos", "ü™ô +10.000 Galeones", "ü™ô +8.000 Galeones", "ü™ô +7.000 Galeones",
                "ü™ô +5.000 Galeones", "ü™ô +3.000 Galeones", "ü™ô +2.000 Galeones", "ü™ô +1.500 Galeones", "ü™ô +1.000 Galeones", "ü™ô +800 Galeones",
                "ü™ô +700 Galeones", "ü™ô +600 Galeones", "ü™ô +500 Galeones", "Puedes robarle 10.000 puntos a alguien", "Puedes robarle 8.000 puntos a alguien", "Puedes robarle 5.000 puntos a alguien",
                "Puedes robarle 10.000 Galeones a alguien del caldero", "Puedes sumarle 5.000 puntos a un compa√±ero"
            ];
            const efectosMalos = [
                "-10.000 puntos", "-8.000 puntos", "-7.000 puntos", "-5.000 puntos", "ü™ô -10.000 Galeones", "ü™ô -7.000 Galeones", "ü™ô -5.000 Galeones", "ü™ô -3.000 Galeones", "ü™ô -2.000 Galeones",
                "ü™ô -1.500 Galeones", "ü™ô -1.000 Galeones", "ü™ô -900 Galeones", "ü™ô -800 Galeones", "ü™ô -700 Galeones", "ü™ô -500 Galeones",
                "Puedes restarle 5.000 puntos a un compa√±ero", "Debes donar 10.000 Galeones a alguien del caldero",
                "Debes donarle 5.000 Galeones a alguien", "Pierdes 2 objetos de tu inventario (a elecci√≥n)",
                "Pierdes 2 objetos de tu inventario (al azar)", "Pierdes 3 objetos de tu inventario"
            ];
            const objetos = [
                "+1 Gragea de todos los sabores ü´ò", "+2 Ranitas a elecci√≥n üç´", "+3 Ranas a elecci√≥n üç´", "+Ranita Amarilla üíõüç´", "+Ranita Verde üíöüç´", "+Ranita Roja ‚ù§Ô∏èüç´", "+Ranita Negra üñ§üç´",
                "+Ranita Rosa ü©∑üç´", "+Ranita Lila üíúüç´", "+Ranita Naranja üß°üç´", "+Ranita Celeste ü©µüç´", "+Amortentia üß™üíò", "+Anillo de Morfin Gaunt üíç",
                "+Carta Vociferadora üíå", "+Detonadores Trampa ü™§", "+El Desiluminador de Ron üí°", "+El giratiempo ‚è±Ô∏è", "+El Traslador üîÆ",
                "+Espejo de Oesed ü™û", "+Felix Felicis üß™üçÄ", "+La pluma de Hermione ü™∂", "+La Recordadora de Neville üé±", "+Mapa del Merodeador üó∫Ô∏è",
                "+Nimbus 2000 ü™Ωüßπ", "+Pastillas Vomitivas üíä", "+Pergamino M√°gico üìú", "+Saeta de Fuego üî•üßπ", "+Varita de Sauco ü™ÑüíÄ",
                "Tienes la posibilidad de elegir entre 2 cosas (ocultas)"
            ];

            // 2. Definimos las probabilidades iniciales y el factor de mejora
            // probBuena: Probabilidad de un efecto bueno (0.0 a 1.0)
            // probMala: Probabilidad de un efecto malo (0.0 a 1.0)
            // probObjeto: Probabilidad de obtener un objeto (0.0 a 1.0)
            // La suma de las tres debe ser 1.0
            // factorMejora: Cu√°nto aumenta la probabilidad de un efecto bueno en cada giro (ej: 0.01 = 1%)
            const configuracionProbabilidades = {
                probBuena: 0.35, // 40% inicial
                probMala: 0.35,  // 45% inicial
                probObjeto: 0.30,// 15% inicial
                factorMejora: 0.00 // Aumenta un 5% la prob. buena en cada giro
            };

            // 3. Contador de giros para mejorar las probabilidades
            let contadorGiros = 0;

            // --- FIN: CONFIGURACI√ìN DE PROBABILIDADES ---


            // --- ELEMENTOS DEL DOM ---
            const cantidadGrageasInput = document.getElementById('cantidadGrageas');
            const grageasContainer = document.getElementById('grageasContainer');
            const abrirBtn = document.getElementById('abrirBtn');
            const resultadoTextoDecorado = document.getElementById('resultadoTextoDecorado');
            const resultadoTextoSimple = document.getElementById('resultadoTextoSimple');
            const simpleTitle = document.getElementById('simpleTitle');
            const resultadoTextoSimpleContainer = document.getElementById('resultadoTextoSimpleContainer');
            const copiarBtnDecorado = document.getElementById('copiarBtnDecorado');
            const copiarBtnSimple = document.getElementById('copiarBtnSimple');
            const saboresList = document.getElementById('saboresList');
            const copiadoMsg = document.getElementById('copiadoMsg');
            const tabDecorado = document.getElementById('tabDecorado');
            const tabSimple = document.getElementById('tabSimple');
            const panelDecorado = document.getElementById('panelDecorado');
            const panelSimple = document.getElementById('panelSimple');

            // --- FUNCIONES ---
            
            const generarSelectores = (cantidad) => {
                grageasContainer.innerHTML = '';
                for (let i = 1; i <= cantidad; i++) {
                    const grageaDiv = document.createElement('div');
                    grageaDiv.className = 'bg-gray-700 p-4 rounded-lg border border-gray-600';
                    grageaDiv.innerHTML = `<h3 class="text-lg font-semibold text-yellow-300 mb-3">Gragea ${i}</h3>`;
                    
                    const selectorContainer = document.createElement('div');
                    selectorContainer.className = 'space-y-2';

                    for (let j = 1; j <= 3; j++) {
                        const select = document.createElement('select');
                        select.className = 'sabor-select w-full bg-gray-600 border border-gray-500 text-white text-sm rounded-lg focus:ring-yellow-500 focus:border-yellow-500 p-2';
                        sabores.forEach(sabor => {
                            const option = document.createElement('option');
                            option.value = sabor.emoji;
                            option.dataset.tipo = sabor.tipo; // Guardar el nombre del sabor
                            option.textContent = `${sabor.emoji} ${sabor.tipo}`;
                            select.appendChild(option);
                        });
                        selectorContainer.appendChild(select);
                    }
                    grageaDiv.appendChild(selectorContainer);
                    grageasContainer.appendChild(grageaDiv);
                }
            };

            const poblarListaSabores = () => {
                saboresList.innerHTML = '';
                sabores.forEach(sabor => {
                    const div = document.createElement('div');
                    div.className = 'bg-gray-700 p-2 rounded-md';
                    div.textContent = `${sabor.emoji} ${sabor.tipo}`;
                    saboresList.appendChild(div);
                });
            };
            
            // Funci√≥n para elegir un efecto basado en las probabilidades din√°micas
            const elegirEfectoAleatorio = () => {
                const { factorMejora } = configuracionProbabilidades;
                
                // Calculamos la probabilidad actual de un efecto bueno, aumentando con cada giro
                let probBuenaActual = configuracionProbabilidades.probBuena + (contadorGiros * factorMejora);
                // Nos aseguramos de que no supere el 95% para que siempre haya una peque√±a chance de algo malo/objeto
                probBuenaActual = Math.min(probBuenaActual, 0.95);

                // Recalculamos las otras probabilidades para que la suma siga siendo 1
                const probRestante = 1.0 - probBuenaActual;
                const totalMalaYObjeto = configuracionProbabilidades.probMala + configuracionProbabilidades.probObjeto;
                const probMalaActual = probRestante * (configuracionProbabilidades.probMala / totalMalaYObjeto);
                const probObjetoActual = probRestante * (configuracionProbabilidades.probObjeto / totalMalaYObjeto);

                // Generamos un n√∫mero aleatorio entre 0 y 1
                const aleatorio = Math.random();

                // Decidimos qu√© tipo de efecto devolver
                if (aleatorio < probBuenaActual) {
                    return efectosBuenos[Math.floor(Math.random() * efectosBuenos.length)];
                } else if (aleatorio < probBuenaActual + probMalaActual) {
                    return efectosMalos[Math.floor(Math.random() * efectosMalos.length)];
                } else {
                    return objetos[Math.floor(Math.random() * objetos.length)];
                }
            };


            const abrirGrageas = () => {
                let resultadoDecorado = '‚ãÜ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚úß‚ó¶üçª‚ó¶‚úß‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ‚ãÜ\n\n';
                resultadoDecorado += '‚ï∞‚îà‚û§ …¢ Ä·¥Ä…¢·¥á·¥Ä ·¥Ö·¥á ·¥õ·¥è·¥Ö·¥èÍú±  ü·¥èÍú± Íú±·¥Ä ô·¥è Ä·¥áÍú± ü´ò\n\n';
                
                let resultadoSimple = '';
                let simpleCounter = 1;

                const grageas = grageasContainer.children;
                for (let i = 0; i < grageas.length; i++) {
                    resultadoDecorado += `${i + 1}.\n`;

                    const selects = grageas[i].querySelectorAll('.sabor-select');
                    selects.forEach(select => {
                        const emoji = select.value;
                        const tipo = select.options[select.selectedIndex].dataset.tipo;
                        
                        // Usamos la nueva funci√≥n para obtener un efecto
                        const efectoAleatorio = elegirEfectoAleatorio();
                        
                        resultadoDecorado += `${emoji}‚Üí ${efectoAleatorio}\n`;
                        resultadoSimple += `${simpleCounter}. ${tipo}: ${efectoAleatorio}\n`;
                        simpleCounter++;
                    });
                    resultadoDecorado += '\n';
                }

                resultadoDecorado += '‚ãÜ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚úß‚ó¶üçª‚ó¶‚úß‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ‚ãÜ';
                
                resultadoTextoDecorado.value = resultadoDecorado.trim();

                // Actualizar la vista simple
                simpleTitle.textContent = 'RESULTADOS';
                resultadoTextoSimple.innerText = resultadoSimple.trim();

                // Incrementamos el contador de giros para la pr√≥xima vez
                contadorGiros++;
            };
            
            const copiarResultado = (viewType) => {
                let textToCopy = '';
                if (viewType === 'decorado') {
                    textToCopy = document.getElementById('resultadoTextoDecorado').value;
                } else if (viewType === 'simple') {
                    const title = simpleTitle.textContent;
                    const content = resultadoTextoSimple.innerText;
                    textToCopy = `${title}\n\n${content}`;
                }

                if (!textToCopy) return;

                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = textToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                
                try {
                    document.execCommand('copy');
                    copiadoMsg.classList.remove('opacity-0');
                    setTimeout(() => {
                        copiadoMsg.classList.add('opacity-0');
                    }, 1500);
                } catch (err) {
                    console.error('Error al intentar copiar: ', err);
                }
                
                document.body.removeChild(tempTextArea);
                window.getSelection().removeAllRanges();
            };

            const cambiarPesta√±a = (tabActiva) => {
                if (tabActiva === 'decorado') {
                    panelDecorado.classList.remove('hidden');
                    panelDecorado.classList.add('flex');
                    panelSimple.classList.add('hidden');
                    panelSimple.classList.remove('flex');

                    tabDecorado.classList.add('active');
                    tabSimple.classList.remove('active');
                } else {
                    panelSimple.classList.remove('hidden');
                    panelSimple.classList.add('flex');
                    panelDecorado.classList.add('hidden');
                    panelDecorado.classList.remove('flex');

                    tabSimple.classList.add('active');
                    tabDecorado.classList.remove('active');
                }
            };

            // --- EVENT LISTENERS ---
            
            cantidadGrageasInput.addEventListener('change', (e) => {
                let val = parseInt(e.target.value, 10);
                if (isNaN(val) || val < 1) {
                    val = 1;
                }
                if (val > 5) {
                    val = 5;
                }
                e.target.value = val;
                generarSelectores(val);
                // Reseteamos el contador de giros si cambian la configuraci√≥n
                contadorGiros = 0; 
            });

            abrirBtn.addEventListener('click', abrirGrageas);
            copiarBtnDecorado.addEventListener('click', () => copiarResultado('decorado'));
            copiarBtnSimple.addEventListener('click', () => copiarResultado('simple'));
            
            tabDecorado.addEventListener('click', () => cambiarPesta√±a('decorado'));
            tabSimple.addEventListener('click', () => cambiarPesta√±a('simple'));

            // --- INICIALIZACI√ìN ---
            poblarListaSabores();
            generarSelectores(parseInt(cantidadGrageasInput.value, 10));
            cambiarPesta√±a('decorado');
        });
    </script>
</body>
</html>
